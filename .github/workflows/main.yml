name: Run Alpaca Trading Bot (Market Hours Only - 1 Min Interval)

on:
  schedule:
    # Runs every minute, Monday to Friday, from 9 AM to 3 PM CST (9:00 AM to 2:59 PM CST)
    - cron: '*/1 9-14 * * 1-5'  # Every minute between 9 AM and 2:59 PM CST

  workflow_dispatch:  # Manual start — can be triggered manually through GitHub UI

jobs:
  run-bot:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install alpaca-trade-api python-dotenv

      - name: Set environment variables from GitHub secrets
        run: |
          echo "APCA_API_KEY_ID=${{ secrets.APCA_API_KEY_ID }}" >> $GITHUB_ENV
          echo "APCA_API_SECRET_KEY=${{ secrets.APCA_API_SECRET_KEY }}" >> $GITHUB_ENV

      - name: Run Alpaca Bot during market hours
        run: |
          python -c "
# The code now only executes the bot when the GitHub Actions cron triggers every minute

print('Running Alpaca bot during market hours...')
result = os.system('python bot.py')  # Runs the bot.py script

if result == 0:
    print('✅ bot.py ran successfully.')
else:
    print(f'❌ bot.py exited with error code {result}')
          "
